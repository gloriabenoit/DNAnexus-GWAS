<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="author" content="Gloria BENOIT" />
      <link rel="shortcut icon" href="../img/favicon.ico" />
    <title>Using PLINK2 - Basic tutorial for performing a GWAS on DNAnexus</title>
    <link rel="stylesheet" href="../css/theme.css" />
    <link rel="stylesheet" href="../css/theme_extra.css" />
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github.min.css" />
        <link href="../css/extra.css" rel="stylesheet" />
    
      <script>
        // Current page data
        var mkdocs_page_name = "Using PLINK2";
        var mkdocs_page_input_path = "plink.md";
        var mkdocs_page_url = null;
      </script>
    
    <!--[if lt IE 9]>
      <script src="../js/html5shiv.min.js"></script>
    <![endif]-->
      <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>
      <script>hljs.highlightAll();</script> 
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
          <a href=".." class="icon icon-home"> Basic tutorial for performing a GWAS on DNAnexus
        </a><div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../search.html" method="get">
      <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="..">Home</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../setup/">First setup</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../jobs/">About jobs</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../input/">Input files</a>
                </li>
              </ul>
              <ul class="current">
                <li class="toctree-l1 current"><a class="reference internal current" href="#">Using PLINK2</a>
    <ul class="current">
    <li class="toctree-l2"><a class="reference internal" href="#input-files">Input files</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#running-a-gwas">Running a GWAS</a>
        <ul>
    <li class="toctree-l3"><a class="reference internal" href="#quality-control">Quality control</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#linear-regression">Linear regression</a>
    </li>
        </ul>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#computing-the-results">Computing the results</a>
    </li>
    </ul>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../regenie/">Using regenie</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../results/">Visualizing results</a>
                </li>
              </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">
      <nav class="wy-nav-top" role="navigation" aria-label="Mobile navigation menu">
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="..">Basic tutorial for performing a GWAS on DNAnexus</a>
        
      </nav>
      <div class="wy-nav-content">
        <div class="rst-content"><div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href=".." class="icon icon-home" aria-label="Docs"></a></li>
      <li class="breadcrumb-item active">Using PLINK2</li>
    <li class="wy-breadcrumbs-aside">
          <a href="https://github.com/gloriabenoit/DNAnexus-GWAS/edit/master/docs/plink.md" class="icon icon-github"> Edit on GitHub</a>
    </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
            <div class="section" itemprop="articleBody">
              
                <h1 id="using-plink2">Using PLINK2</h1>
<p>Every file created during this analysis will be stored in a main directory called <code>plink_gwas_BMI</code>.</p>
<h2 id="input-files">Input files</h2>
<p>Before running a GWAS on DNAnexus using PLINK2, you need to make sure you have these 3 files uploaded to DNAnexus:</p>
<ul>
<li>The phenotype: <code>plink_BMI.txt</code></li>
<li>The ids of individuals we wish to keep: <code>white british.txt</code></li>
<li>The covariates to use: <code>covariates.txt</code></li>
</ul>
<p>You can check their presence with the following command:</p>
<pre><code class="language-bash">dx ls
</code></pre>
<p>Please refer to the <a href="../input/">Input files section</a> if you don't have these files.</p>
<h2 id="running-a-gwas">Running a GWAS</h2>
<p>On DNAnexus, PLINK2 is available as part of the <a href="https://ukbiobank.dnanexus.com/app/swiss-army-knife">Swiss Army Knife app</a>.
We choose to use the same instance for all GWASs, to simplify the code, but this can be changed to your liking. Same for the priority and the cost limit. </p>
<h3 id="quality-control">Quality control</h3>
<p>We perform the QC at the same time as our GWAS. The variants are filtered using following options:</p>
<pre><code class="language-text">--maf 0.0001 --hwe 1e-50 --geno 0.1 --mind 0.1
</code></pre>
<blockquote>
<p>Please change the thresholds according to your preferences.</p>
</blockquote>
<h3 id="linear-regression">Linear regression</h3>
<pre><code class="language-bash">pheno=&quot;BMI&quot;
pheno_path=&quot;/gwas_tutorial/plink_$pheno.txt&quot;
ind_path=&quot;/gwas_tutorial/white_british.txt&quot;
ind=$(basename &quot;$ind_path&quot;)
cov_path=&quot;/gwas_tutorial/covariates.txt&quot;
cov=$(basename &quot;$cov_path&quot;)

instance=&quot;mem1_ssd1_v2_x16&quot;
threads=16
priority=&quot;low&quot;
cost_limit=3

dx mkdir -p plink_gwas_$pheno

for chr_num in $(seq 1 22); do
    prefix=&quot;/Bulk/Whole genome sequences/Population level genome variants, BGEN format - interim 200k release//ukb24306_c${chr_num}_b0_v1&quot;
    bgen=$(basename &quot;$prefix&quot;)

    plink_command=&quot;plink2 \
                --threads $threads \
                --maf 0.0001 \
                --hwe 1e-50 \
                --geno 0.1 \
                --mind 0.1 \
                --glm \
                --keep $ind \
                --covar $cov \
                --covar-name PC1,PC2,PC3,PC4,PC5,PC6,PC7,PC8,PC9,PC10,PC11,PC12,PC13,PC14,PC15,PC16,PC17,PC18,Age,Sex \
                --pheno plink_$pheno.txt \
                --bgen $bgen.bgen ref-first \
                --sample $bgen.sample \
                --no-psam-pheno \
                --out gwas_$pheno/sumstat_c${chr_num}&quot;

    dx run swiss-army-knife \
        --priority &quot;$priority&quot; --cost-limit &quot;$cost_limit&quot; \
        -icmd=&quot;$plink_command&quot; \
        --instance-type &quot;$instance&quot; \
        --name=&quot;plink_gwas_${pheno}_c${chr_num}&quot; \
        --tag=&quot;plink&quot; \
        --tag=&quot;GWAS&quot; \
        --tag=&quot;$pheno&quot; \
        --tag=&quot;c${chr_num}&quot; \
        -iin=&quot;$ind_path&quot; \
        -iin=&quot;$cov_path&quot; \
        -iin=&quot;$pheno_path&quot; \
        -iin=&quot;$prefix.sample&quot; \
        -iin=&quot;$prefix.bgen&quot; \
        -y
done

dx cd ../
</code></pre>
<p>This command outputs 22 files:</p>
<ul>
<li><code>sumstat_c&lt;chrom-number&gt;.BMI.glm.linear</code> contains the values for the regression <em>per chromosome</em></li>
</ul>
<p>The files will be stored in the main directory, <code>plink_gwas_BMI</code>.</p>
<blockquote>
<p>Please note, the commands are the same whether your phenotype is quantitative or binary. Only the name of the output file will change (<code>.glm.linear</code> or <code>.glm.logistic.hybrid</code> for linear and logistic regression respectively).</p>
</blockquote>
<h2 id="computing-the-results">Computing the results</h2>
<p>Now that all of the summary statistics are computed, we can download them, clean them up and combine them into one clean file.</p>
<p>PLINK outputs a value for each of the covariates, in addition to the global p-value. However, these do not interest us, we only want to keep the global p-value. The following scripts helps clean up the p-values, and concatenates them into a single file.</p>
<blockquote>
<p>Please change the value of <code>type</code> based on the regression performed: <em>"linear"</em> or <em>"logistic.hybrid"</em>.</p>
</blockquote>
<pre><code class="language-bash">pheno=&quot;BMI&quot;
type=&quot;linear&quot; # to change accordingly
results_path=&quot;plink_gwas_$pheno&quot;
stat_path=&quot;statistics&quot;

mkdir -p $stat_path

for chr_num in $(seq 1 22); do
    result=&quot;sumstat_c${chr_num}.$pheno.glm.$type&quot;
    dx download &quot;$results_path/$result&quot; -o $stat_path
    if [ $chr_num -eq 1 ]; then
        head -n1 &quot;$stat_path/$result&quot; &gt; &quot;sumstat_${pheno}.ADD&quot;
    fi
    head -n1 &quot;$stat_path/$result&quot; &gt; &quot;$stat_path/sumstat_c${chr_num}.ADD&quot;
    grep &quot;ADD&quot; &quot;$stat_path/$result&quot; &gt;&gt; &quot;$stat_path/sumstat_c${chr_num}.ADD&quot;
    grep &quot;ADD&quot; &quot;$stat_path/$result&quot; &gt;&gt; &quot;sumstat_${pheno}.ADD&quot;
done
</code></pre>
<p>This command outputs 23 files:</p>
<ul>
<li><code>sumstat_c&lt;chrom-number&gt;.ADD</code> contains the cleaned up values for the regression <em>per chromosome</em></li>
<li><code>sumstat_BMI.ADD</code> contains the concatenated cleaned up values for the regression</li>
</ul>
<p>The files will be stored in a new directory named <code>statistics</code>, locally this time, containing all of the summary statistics per chromosome. The combination of all of them will be located at the same level as <code>statistics</code>, making it easier to find.</p>
<p>Congratulations, you have successfully completed a GWAS using PLINK2 on DNAnexus!</p>
              
            </div>
          </div><footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="Footer Navigation">
        <a href="../input/" class="btn btn-neutral float-left" title="Input files"><span class="icon icon-circle-arrow-left"></span> Previous</a>
        <a href="../regenie/" class="btn btn-neutral float-right" title="Using regenie">Next <span class="icon icon-circle-arrow-right"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
  </div>

  Built with <a href="https://www.mkdocs.org/">MkDocs</a> using a <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
          
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="Versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    
        <span>
          <a href="https://github.com/gloriabenoit/DNAnexus-GWAS" class="fa fa-github" style="color: #fcfcfc"> GitHub</a>
        </span>
    
    
      <span><a href="../input/" style="color: #fcfcfc">&laquo; Previous</a></span>
    
    
      <span><a href="../regenie/" style="color: #fcfcfc">Next &raquo;</a></span>
    
  </span>
</div>
    <script src="../js/jquery-3.6.0.min.js"></script>
    <script>var base_url = "..";</script>
    <script src="../js/theme_extra.js"></script>
    <script src="../js/theme.js"></script>
      <script src="../search/main.js"></script>
    <script>
        jQuery(function () {
            SphinxRtdTheme.Navigation.enable(true);
        });
    </script>

</body>
</html>
