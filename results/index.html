<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="author" content="Gloria BENOIT" />
      <link rel="shortcut icon" href="../img/favicon.ico" />
    <title>Visualizing results - Basic tutorial for performing a GWAS on DNAnexus</title>
    <link rel="stylesheet" href="../css/theme.css" />
    <link rel="stylesheet" href="../css/theme_extra.css" />
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github.min.css" />
        <link href="../css/extra.css" rel="stylesheet" />
    
      <script>
        // Current page data
        var mkdocs_page_name = "Visualizing results";
        var mkdocs_page_input_path = "results.md";
        var mkdocs_page_url = null;
      </script>
    
    <!--[if lt IE 9]>
      <script src="../js/html5shiv.min.js"></script>
    <![endif]-->
      <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>
      <script>hljs.highlightAll();</script> 
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
          <a href=".." class="icon icon-home"> Basic tutorial for performing a GWAS on DNAnexus
        </a><div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../search.html" method="get">
      <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="..">Home</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../start/">Getting started</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../jobs/">About jobs</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../input/">Input files</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../plink/">Using PLINK2</a>
                </li>
              </ul>
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../regenie/">Using Regenie</a>
                </li>
              </ul>
              <ul class="current">
                <li class="toctree-l1 current"><a class="reference internal current" href="#">Visualizing results</a>
    <ul class="current">
    <li class="toctree-l2"><a class="reference internal" href="#generatating-plots">Generatating plots</a>
    </li>
    <li class="toctree-l2"><a class="reference internal" href="#expected-plots">Expected plots</a>
        <ul>
    <li class="toctree-l3"><a class="reference internal" href="#plink2">PLINK2</a>
    </li>
    <li class="toctree-l3"><a class="reference internal" href="#regenie">Regenie</a>
    </li>
        </ul>
    </li>
    </ul>
                </li>
              </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">
      <nav class="wy-nav-top" role="navigation" aria-label="Mobile navigation menu">
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="..">Basic tutorial for performing a GWAS on DNAnexus</a>
        
      </nav>
      <div class="wy-nav-content">
        <div class="rst-content"><div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href=".." class="icon icon-home" aria-label="Docs"></a></li>
      <li class="breadcrumb-item active">Visualizing results</li>
    <li class="wy-breadcrumbs-aside">
          <a href="https://github.com/gloriabenoit/DNAnexus-GWAS/edit/master/docs/results.md" class="icon icon-github"> Edit on GitHub</a>
    </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
            <div class="section" itemprop="articleBody">
              
                <h1 id="visualizing-results">Visualizing results</h1>
<p>Once your GWAS is complete, you might want to analyze its summary statistics.
Here, we provide code to compute a <a href="https://www.sciencedirect.com/topics/biochemistry-genetics-and-molecular-biology/manhattan-plot">Manhattan plot</a> and a <a href="https://jnmaloof.github.io/BIS180L_web/slides/11_QQPlots.html#1">QQ plot</a> from your results.</p>
<h2 id="generatating-plots">Generatating plots</h2>
<p>We propose the following code, as a way to see how such plots are made.</p>
<blockquote>
<p>Please keep in mind this code is not really optimized, but shoudl run decently quickly on big data.
We suggest using other softwares with which you are more familiar, or that you know are faster.</p>
</blockquote>
<pre><code class="language-python">&quot;&quot;&quot;Generate Manhattan plot and QQ plot from GWAS summary statistics.&quot;&quot;&quot;

import numpy as np
import matplotlib.pyplot as plt

def read_results(phenotype, software):
    &quot;&quot;&quot; Parse GWAS result file and get values.

    Parameters
    ----------
    phenotype : str
        Phenotype name.
    software : str { 'p', 'r'}
        Either 'p' for PLINK2 or 'r' for Regenie,
        to correctly format the file.

    Returns
    -------
    list
        Chromosome numbers.
    list
        Transformed p-values (-log10).
    &quot;&quot;&quot;
    chroms = []
    pvals = []

    # Software specific format.
    if software == 'p':
        chrom_name = &quot;#CHROM&quot;
        p_name = &quot;P&quot;
        softname = &quot;plink&quot;
    elif software == 'r':
        chrom_name = &quot;CHROM&quot;
        p_name = &quot;LOG10P&quot;
        softname = &quot;regenie&quot;
    filename = f&quot;{softname}_sumstat_{phenotype}.tsv&quot;

    with open(filename, 'r') as glm:
        for line in glm:
            columns = line.split()
            if line.startswith(chrom_name):
                chrom_id = columns.index(chrom_name)
                p_id = columns.index(p_name)
            else:
                chroms.append(int(columns[chrom_id]))
                if software == 'p':
                    pvals.append(-np.log10(float(columns[p_id])))
                elif software == 'r':
                    pvals.append(float(columns[p_id]))

    return chroms, pvals

def manhattan_plot(chroms, pvals, phenotype, software):
    &quot;&quot;&quot; Generate Manhattan plot.

    Parameters
    ----------
    chroms : list
        Chromosome numbers.
    pvals : list
        Transformed p-values (-log10).
    phenotype : str
        Phenotype name.
    software : str { 'p', 'r'}
        Either 'p' for PLINK2 or 'r' for Regenie,
        to correctly format the file.

    Returns
    -------
    img
        Manhattan plot.
    &quot;&quot;&quot;
    # Software specific format.
    if software == 'p':
        softname = &quot;plink&quot;
    elif software == 'r':
        softname = &quot;regenie&quot;
    output = f&quot;{softname}_{phenotype}_Manhattan_plot.png&quot;

    chrom_distrib = {}
    colors = []
    for chrom in chroms:
        chrom_number = chrom
        # Specify color
        if chrom_number%2 == 0:
            colors.append(&quot;darkgray&quot;)
        else:
            colors.append(&quot;black&quot;)

        # Track chromosome number
        if chrom_number not in chrom_distrib:
            chrom_distrib[chrom_number] = 1
        else:
            chrom_distrib[chrom_number] += 1

    # Plot
    plt.figure(figsize=(10, 8), dpi=330)
    plt.scatter(range(len(chroms)), pvals, color=colors, s=5)

    # Correct x axis
    istart = 0
    iend = 0
    x_ticks = []
    x_labels = []
    for chrom, number in chrom_distrib.items():
        # Update end idx
        iend += number

        pos = (istart + iend - 1) / 2
        x_ticks.append(pos)
        x_labels.append(chrom)

        # Update start idx
        istart = iend

    # Plot suggestive and significative thresholds
    plt.axhline(-np.log10(5e-5), linestyle=&quot;dotted&quot;, color=&quot;red&quot;)
    plt.axhline(-np.log10(5e-8), linestyle=&quot;dashed&quot;, color=&quot;red&quot;)

    # Plot info
    plt.xticks(ticks=x_ticks, labels=x_labels, rotation=90)
    plt.xlabel(&quot;Chromosome&quot;)
    plt.ylabel(&quot;$-log_{10}(p)$&quot;)

    # Save
    plt.savefig(output, bbox_inches=&quot;tight&quot;)
    plt.close()

def qq_plot(pvals, phenotype, software):
    &quot;&quot;&quot; Generate QQ plot.

    Parameters
    ----------
    pvals : list
        Transformed p-values (-log10).
    phenotype : str
        Phenotype name.
    software : str { 'p', 'r'}
        Either 'p' for PLINK2 or 'r' for Regenie,
        to correctly format the file.

    Returns
    -------
    img
        QQ plot.
    &quot;&quot;&quot;
    # Software specific format.
    if software == 'p':
        softname = &quot;plink&quot;
    elif software == 'r':
        softname = &quot;regenie&quot;
    output = f&quot;{softname}_{phenotype}_QQ_plot.png&quot;

    # Sort p-values
    pvals.sort(reverse=True)

    # Expected values
    n = len(pvals)
    exp = -np.log10(np.arange(n, dtype=float) / n)

    # Plot
    plt.figure(figsize=(10, 8), dpi=330)
    plt.axline((0, 0), slope=1, color=&quot;red&quot;, linestyle=&quot;dashed&quot;, zorder=0)
    plt.scatter(exp, pvals, color=&quot;black&quot;, s=5, zorder=10)
    plt.xlabel(&quot;Expected $-log_{10}(p)$&quot;)
    plt.ylabel(&quot;Observed $-log_{10}(p)$&quot;)

    # Save
    plt.savefig(output, bbox_inches=&quot;tight&quot;)
    plt.close()

# Input
PHENOTYPE = &quot;BMI&quot;
SOFTWARE = 'p' # for PLINK2 or 'r' for Regenie

# Read values
CHROMS, PVALS = read_results(PHENOTYPE, SOFTWARE)

# Manhattan Plot
manhattan_plot(CHROMS, PVALS, PHENOTYPE, SOFTWARE)
# QQ plot
qq_plot(PVALS, PHENOTYPE, SOFTWARE)
</code></pre>
<p>This command outputs 2 files:</p>
<ul>
<li><code>&lt;software&gt;_BMI_Manhattan_plot.png</code> (~190 Ko) contains the Manhattan plot for the whole GWAS</li>
<li><code>&lt;software&gt;_BMI_QQ_plot.png</code> (~ 110 Ko) contains the QQ plot for the whole GWAS</li>
</ul>
<blockquote>
<p>This script should take between 5 and 10 minutes to compute both plots.</p>
</blockquote>
<h2 id="expected-plots">Expected plots</h2>
<h3 id="plink2">PLINK2</h3>
<p>By the end of this tutorial, when using PLINK2, you should obtain the following Manhattan plot:</p>
<p><img alt="image info" src="../img/plink_BMI_Manhattan_plot.png" title="PLINK2 Manhattan plot" /></p>
<p>And the following QQ plot:</p>
<p><img alt="image info" src="../img/plink_BMI_QQ_plot.png" title="PLINK2 QQ plot" /></p>
<h3 id="regenie">Regenie</h3>
<p>By the end of this tutorial, when using Regenie, you should obtain the following Manhattan plot:</p>
<p><img alt="image info" src="../img/regenie_BMI_Manhattan_plot.png" title="Regenie Manhattan plot" /></p>
<p>And the following QQ plot:</p>
<p><img alt="image info" src="../img/regenie_BMI_QQ_plot.png" title="Regenie QQ plot" /></p>
              
            </div>
          </div><footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="Footer Navigation">
        <a href="../regenie/" class="btn btn-neutral float-left" title="Using Regenie"><span class="icon icon-circle-arrow-left"></span> Previous</a>
    </div>

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
  </div>

  Built with <a href="https://www.mkdocs.org/">MkDocs</a> using a <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
          
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="Versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    
        <span>
          <a href="https://github.com/gloriabenoit/DNAnexus-GWAS" class="fa fa-github" style="color: #fcfcfc"> GitHub</a>
        </span>
    
    
      <span><a href="../regenie/" style="color: #fcfcfc">&laquo; Previous</a></span>
    
    
  </span>
</div>
    <script src="../js/jquery-3.6.0.min.js"></script>
    <script>var base_url = "..";</script>
    <script src="../js/theme_extra.js"></script>
    <script src="../js/theme.js"></script>
      <script src="../search/main.js"></script>
    <script>
        jQuery(function () {
            SphinxRtdTheme.Navigation.enable(true);
        });
    </script>

</body>
</html>
